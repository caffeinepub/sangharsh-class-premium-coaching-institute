{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Sangharsh Classes is a Vite + React + TailwindCSS single-page marketing website for a coaching institute (classes 7th–12th). The public homepage is section-based (Header, Hero, About, Faculty, Courses, Contact, Footer) and is driven by a centralized canonical content object used by both the React UI and a build-time static-export generator. The build pipeline includes a Vite closeBundle plugin that generates a fully offline-capable static HTML/CSS/JS version of the site and packages it as a downloadable ZIP served from /website-code.zip. The repo also contains an Internet Computer (ICP) Motoko backend canister providing role-based access control (admin/user/guest) bootstrapped via an environment secret and a caller-provided token, plus simple per-principal user profile storage. The frontend integrates Internet Identity authentication, actor creation, and data fetching via TanStack React Query, along with deployment hardening assets (404 SPA fallback, _redirects/_headers, sitemap.xml, robots.txt, Google verification file, and IC asset-canister header rules).",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Single-page marketing homepage composition",
      "synonyms": [
        "Landing page",
        "Marketing SPA"
      ],
      "description": "Renders a public homepage composed of Header, Hero, About, Faculty, Courses, Contact, and Footer sections, plus a floating WhatsApp CTA.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "Centralized canonical marketing content module",
      "synonyms": [
        "Single source of truth",
        "marketingSiteContent"
      ],
      "description": "Defines site metadata, navigation, section copy, and image paths in a single module used by both the React UI and the static-export generator.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Responsive header with smooth-scroll navigation and mobile menu",
      "synonyms": [
        "Sticky header",
        "Mobile sheet menu"
      ],
      "description": "Fixed header that changes style on scroll, provides desktop navigation, and a mobile Sheet menu; clicks scroll smoothly to section anchors.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "Hero section with CTAs and stats",
      "synonyms": [
        "Top banner",
        "Hero block"
      ],
      "description": "Hero banner with background overlay, bilingual heading, guarantee badge, CTA buttons, and icon-based stat cards.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "About section (content-driven)",
      "synonyms": [
        "About Sangharsh Classes"
      ],
      "description": "Displays multi-paragraph about copy and a focused feature card sourced from canonical content.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "Faculty section (content-driven cards)",
      "synonyms": [
        "Teacher listing",
        "Faculty grid"
      ],
      "description": "Renders a responsive grid of faculty cards with photos, subject badges, role, experience, and specialization from canonical content.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Courses section (classes 7th–12th)",
      "synonyms": [
        "Programs grid",
        "Offerings"
      ],
      "description": "Displays course offerings (classes 7–12) with descriptions and feature bullets, plus an extra promotional banner listing subjects.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "Contact section with deep-link actions",
      "synonyms": [
        "Call/email/WhatsApp actions"
      ],
      "description": "Shows phone/email/location and provides one-click actions using tel:, mailto:, and wa.me links/buttons.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Footer with quick links and social media links",
      "synonyms": [
        "Site footer",
        "Social icons"
      ],
      "description": "Footer includes branding/about text, section quick links, contact information, social outbound links (Facebook/Instagram/YouTube), and attribution.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Floating WhatsApp contact button",
      "synonyms": [
        "WhatsApp FAB",
        "Sticky WhatsApp CTA"
      ],
      "description": "Fixed-position button that opens WhatsApp chat to the configured institute phone number in a new tab.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "User-facing website-code ZIP download button",
      "synonyms": [
        "Download Website Code",
        "Static export download"
      ],
      "description": "Provides a UI button that downloads /website-code.zip as sangharsh-classes-website.zip from static assets.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "Static site renderer (HTML/CSS/JS generator)",
      "synonyms": [
        "Offline export renderer",
        "renderStaticSite"
      ],
      "description": "Generates a standalone static site (index.html, css/style.css, js/script.js) from canonical content with basic HTML escaping and built-in navigation behaviors.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Static export asset manifest",
      "synonyms": [
        "staticExportAssets",
        "Export asset list"
      ],
      "description": "Defines which public images should be copied into the static export under assets/images/ with consistent destination names.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Build-time ZIP packaging of static export (Vite plugin)",
      "synonyms": [
        "staticExportPlugin",
        "Archiver ZIP build"
      ],
      "description": "On Vite build completion, creates dist/static-export, writes generated HTML/CSS/JS, copies assets, zips it to dist/website-code.zip, verifies size, and cleans up the temp folder.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "Build output verification logging",
      "synonyms": [
        "Build verification checks",
        "Dist sanity checks"
      ],
      "description": "After build, logs checks to detect accidental deployment of source index.html (references /src/main.tsx) and verifies required static files exist in dist/.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "Static hosting hardening assets",
      "synonyms": [
        "SPA fallback + headers/redirects",
        "Static SEO file serving"
      ],
      "description": "Includes public/404.html SPA fallback with static-file exclusions, public/_redirects for SPA routing, public/_headers for correct Content-Type (and ZIP download headers), sitemap.xml, robots.txt, and Google verification file; also includes frontend/.ic-assets.json rules for ICP deployments.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "SEO metadata and JSON-LD structured data in HTML entry",
      "synonyms": [
        "OpenGraph tags",
        "Structured data"
      ],
      "description": "Source index.html defines title/description, canonical, OG meta tags, favicon tags, and JSON-LD schemas (Organization, WebSite).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "Runtime SEO guards for canonical/noindex enforcement",
      "synonyms": [
        "SEO guard",
        "Noindex on non-canonical domain"
      ],
      "description": "At runtime, enforces canonical and og:url to the custom domain and applies robots noindex/nofollow on the configured Caffeine subdomain.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "Runtime diagnostics logging",
      "synonyms": [
        "Global error logging",
        "Unhandled rejection capture"
      ],
      "description": "Registers window error and unhandledrejection listeners and logs initialization markers for production debugging.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Top-level React error boundary and fallback UI",
      "synonyms": [
        "AppErrorBoundary",
        "Runtime error fallback"
      ],
      "description": "Catches render/lifecycle errors and displays a user-facing fallback with refresh/home actions to avoid blank-screen failures.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "Internet Identity authentication provider",
      "synonyms": [
        "AuthClient integration",
        "InternetIdentityProvider"
      ],
      "description": "React context provider that initializes @dfinity/auth-client, restores identity on mount, and exposes login/logout and status flags.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Backend actor creation and caching tied to identity",
      "synonyms": [
        "useActor",
        "Identity-bound actor"
      ],
      "description": "Creates an anonymous actor when logged out and an identity-bound actor when logged in; cached via React Query and triggers invalidation/refetch of dependent queries when the actor changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Safe backend actor initialization hook",
      "synonyms": [
        "useBackendActorSafe",
        "Non-fatal RBAC init"
      ],
      "description": "Creates an identity-bound actor and only attempts RBAC initialization when a caffeineAdminToken secret is present; initialization failures are logged and treated as non-fatal.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "URL parameter utilities with hash-secret handling",
      "synonyms": [
        "urlParams utilities",
        "Admin token extraction"
      ],
      "description": "Utilities to read URL parameters from query/hash, persist values in sessionStorage, extract sensitive secrets from the URL hash, and remove them from the address bar via history.replaceState.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "Per-caller user profile hooks (frontend)",
      "synonyms": [
        "useGetCallerUserProfile",
        "useSaveCallerUserProfile"
      ],
      "description": "React Query hook to fetch the current caller’s profile and an async helper to save it via the backend actor, integrating actor-fetching state into loading flags.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "Role-based access control (Motoko)",
      "synonyms": [
        "RBAC",
        "AccessControl",
        "admin/user/guest roles"
      ],
      "description": "Implements roles (#admin/#user/#guest); supports initialization using a canister env admin token plus a caller-provided token, querying caller role/admin status, and admin-only role assignment.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-27",
      "title": "Per-user profile storage with authorization (Motoko)",
      "synonyms": [
        "UserProfile storage",
        "getCallerUserProfile/saveCallerUserProfile"
      ],
      "description": "Stores per-principal UserProfile records in a Map; read/write is gated to #user permission, while admins can query another principal’s profile via getUserProfile.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "feature-generate-overwrite-a-valid-xml-sitemap-at-frontend-public-sitemap-xml-using-absolute-urls-rooted-at-https-sangharshclasses-in-including-only-urls-that-correspond-to-existing-frontend-pages-routes-no-url-fragments-like-about-and-no-new-pages",
      "title": "Generate/overwrite a valid XML sitemap at frontend/public/sitemap.xml using absolute URLs rooted at https://sangharshclasses.in, including ONLY URLs that correspond to existing frontend pages/routes (no URL fragments like #about, and no new pages).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-do-not-modify-any-design-layout-content-or-any-files-other-than-the-sitemap-xml-file-required-in-this-request",
      "title": "Do not modify any design, layout, content, or any files other than the sitemap.xml file required in this request.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-after-generating-the-sitemap-xml-output-the-public-sitemap-url-exactly-as-https-sangharshclasses-in-sitemap-xml",
      "title": "After generating the sitemap.xml, output the public sitemap URL exactly as: https://sangharshclasses.in/sitemap.xml",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Generate and add a static sitemap.xml at the site root using absolute URLs for https://sangharshclasses.in, without changing any other files/content/layout, and provide the public link https://sangharshclasses.in/sitemap.xml",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "architectural_notes": [
    "Frontend is a Vite-powered React SPA styled with TailwindCSS (OKLCH design tokens) and shadcn/ui primitives (Button, Card, Sheet, Badge).",
    "Marketing content is centralized in a single module (marketingSiteContent) consumed by both React components and the static-export renderer to keep content consistent.",
    "TanStack React Query is used for async state (actor creation and backend queries/mutations) with query keys tied to the authenticated principal.",
    "Authentication uses Internet Identity via @dfinity/auth-client, exposed through a React context provider that restores identity on reload.",
    "ICP backend is written in Motoko and composes authorization via an include/mixin pattern (MixinAuthorization + AccessControl).",
    "RBAC bootstrapping uses a canister environment variable (CAFFEINE_ADMIN_TOKEN) compared against a caller-provided token to assign the first admin.",
    "A custom Vite closeBundle plugin generates a static-export directory (index.html/css/js + assets) and creates website-code.zip using archiver with stream event handling.",
    "Static hosting behavior is hardened using public/404.html SPA fallback plus Netlify-style _redirects/_headers, and ICP asset configuration via frontend/.ic-assets.json.",
    "Runtime utilities include SEO guards for canonical/noindex enforcement and global runtime diagnostics logging for production debugging.",
    "Sitemap generation/update must be the only change: create a valid static sitemap.xml in the frontend root with absolute URLs for https://sangharshclasses.in and avoid modifying any other files."
  ],
  "known_issues": [
    "Many admin-panel files under frontend/src/admin/** and several admin-related hooks (useAdminStatus, useAdminUsers, useWebsiteContent, useSectionConfigs) are empty placeholders in this snapshot, so an admin/CMS UI is not actually implemented here.",
    "staticExportAssets entries use source paths starting with a leading '/' (e.g. '/assets/...'); path.join(publicDir, asset.source) will ignore publicDir on POSIX, causing asset copy to fail and the exported ZIP to miss images.",
    "frontend/src/hooks/useActor.ts always calls _initializeAccessControlWithSecret(adminToken) even when the token is empty, which can permanently register the first authenticated caller as #user and prevent later admin bootstrapping for that principal (because initialize() is no-op for already-registered users).",
    "backend/authorization/access-control.mo traps with \"User is not registered\" when an authenticated principal has not been initialized; if initialization is skipped (e.g., safe actor without token) user-gated methods can trap.",
    "MixinAuthorization._initializeAccessControlWithSecret traps if CAFFEINE_ADMIN_TOKEN is not set on the canister, which can break initialization in misconfigured environments.",
    "Backend userRoles and userProfiles are stored only in in-memory Maps (no stable memory), so state can be lost across upgrades/reinstalls.",
    "InternetIdentityProvider sets loginStatus to 'loginError' on init failure, but the effect's finally block unconditionally sets it back to 'idle', potentially masking initialization errors.",
    "Branding is inconsistent: marketingSiteContent.site.name is \"Sangharsh Class\" (singular) while SEO/title and other copy use \"Sangharsh Classes\" (plural).",
    "There are two Tailwind CSS entry files (frontend/index.css and frontend/src/index.css); the app imports the src version, leaving the root one potentially stale/confusing.",
    "frontend/public/404.html excludes several static files from redirect, but does not list /website-code.zip; correctness currently depends on _redirects ensuring it is served as a static 200."
  ],
  "isFixRequest": false,
  "gameProjectType": "none",
  "projectName": "Sangharsh Classes",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}